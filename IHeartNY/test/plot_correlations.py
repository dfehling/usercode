from ROOT import *

gStyle.SetOptStat(000000)
gStyle.SetPaintTextFormat( '.2f' )

gStyle.SetPadRightMargin(0.12);
gStyle.SetPadLeftMargin(0.15);
gStyle.SetPadTopMargin(0.05);
gStyle.SetPadBottomMargin(0.15);


pdfnames = ["CT10_nom_qcd", "CT10_pdfup_qcd", "CT10_pdfdown_qcd"]
channels = ["mu", "el", "comb"]

### THESE BELOW ARE FOR EXTERNALIZE LUMINOSITY & B-TAGGING !!! ###

for pdfname in pdfnames :
    for ich in channels :

        # ---------------------------------- muon only fit ----------------------------------
        if pdfname=="CT10_nom_qcd" and ich=="mu": 
            cov = [[  7.80352257e-03,  -7.64687565e-03,   4.52530308e-03,
         -2.11672895e-02,  -5.88042230e-04,  -2.45134891e-03,
         -3.53282979e-02],
       [ -7.64687565e-03,   4.44347676e-01,  -6.63049387e-02,
          2.22318613e-02,  -7.72458184e-03,  -6.74175022e-02,
          2.31534079e-02],
       [  4.52530308e-03,  -6.63049387e-02,   6.47644296e-01,
         -1.24386947e-02,   2.04915814e-02,  -1.07899104e-02,
         -1.74571213e-02],
       [ -2.11672895e-02,   2.22318613e-02,  -1.24386947e-02,
          1.18125655e-01,  -6.10314645e-02,  -1.73274589e-02,
          9.86551067e-02],
       [ -5.88042230e-04,  -7.72458184e-03,   2.04915814e-02,
         -6.10314645e-02,   7.72230368e-01,  -8.49712816e-03,
         -1.06613928e-02],
       [ -2.45134891e-03,  -6.74175022e-02,  -1.07899104e-02,
         -1.73274589e-02,  -8.49712816e-03,   2.56134705e-02,
          1.37541366e-02],
       [ -3.53282979e-02,   2.31534079e-02,  -1.74571213e-02,
          9.86551067e-02,  -1.06613928e-02,   1.37541366e-02,
          1.85306176e-01]]

        if pdfname=="CT10_pdfup_qcd" and ich=="mu": 
            cov = [[  5.53234173e-03,  -6.54592312e-03,   3.36006405e-03,
         -1.63397768e-02,  -3.64606402e-05,  -3.16699119e-03,
         -3.05063617e-02],
       [ -6.54592312e-03,   4.54965508e-01,  -7.00168344e-02,
          2.24953632e-02,  -5.94180145e-03,  -6.97141673e-02,
          2.37014066e-02],
       [  3.36006405e-03,  -7.00168344e-02,   6.42431887e-01,
         -9.87376438e-03,   2.01058920e-02,  -1.02398858e-02,
         -1.50919614e-02],
       [ -1.63397768e-02,   2.24953632e-02,  -9.87376438e-03,
          1.03642976e-01,  -6.07724704e-02,  -1.46320061e-02,
          9.22106570e-02],
       [ -3.64606402e-05,  -5.94180145e-03,   2.01058920e-02,
         -6.07724704e-02,   7.81778308e-01,  -9.42480248e-03,
         -1.27334111e-02],
       [ -3.16699119e-03,  -6.97141673e-02,  -1.02398858e-02,
         -1.46320061e-02,  -9.42480248e-03,   2.84957737e-02,
          2.05761451e-02],
       [ -3.05063617e-02,   2.37014066e-02,  -1.50919614e-02,
          9.22106570e-02,  -1.27334111e-02,   2.05761451e-02,
          1.92744680e-01]]

        if pdfname=="CT10_pdfdown_qcd" and ich=="mu": 
            cov = [[ 0.01049687, -0.00916292,  0.00536292, -0.02645036, -0.00101409,
        -0.00177476, -0.03995128],
       [-0.00916292,  0.43792172, -0.06252493,  0.02294021, -0.00846001,
        -0.06590463,  0.02394938],
       [ 0.00536292, -0.06252493,  0.64444775, -0.01373062,  0.01987492,
        -0.0109981 , -0.01764885],
       [-0.02645036,  0.02294021, -0.01373062,  0.13335874, -0.06145312,
        -0.01975253,  0.10411578],
       [-0.00101409, -0.00846001,  0.01987492, -0.06145312,  0.76314757,
        -0.00807492, -0.00976304],
       [-0.00177476, -0.06590463, -0.0109981 , -0.01975253, -0.00807492,
         0.023882  ,  0.00911181],
       [-0.03995128,  0.02394938, -0.01764885,  0.10411578, -0.00976304,
         0.00911181,  0.17819396]]
            
        # ---------------------------------- electron only fit ----------------------------------
        if pdfname=="CT10_nom_qcd" and ich=="el": 
            cov = [[  7.24661044e-03,  -7.62172841e-03,   6.46097297e-04,
          8.88850619e-03,  -1.96068661e-02,  -9.70377331e-03,
         -2.10310504e-02],
       [ -7.62172841e-03,   2.54632318e-01,   6.97504965e-02,
          3.99524616e-02,   3.94375558e-02,  -5.46105847e-02,
          1.98366384e-04],
       [  6.46097297e-04,   6.97504965e-02,   5.32388432e-01,
          5.63762040e-02,   5.06230176e-02,  -5.51948160e-02,
         -2.57383153e-02],
       [  8.88850619e-03,   3.99524616e-02,   5.63762040e-02,
          1.42222524e-01,   3.33113798e-02,  -5.32201247e-02,
         -4.34088354e-02],
       [ -1.96068661e-02,   3.94375558e-02,   5.06230176e-02,
          3.33113798e-02,   8.47402574e-01,  -3.56107816e-02,
          4.29041950e-02],
       [ -9.70377331e-03,  -5.46105847e-02,  -5.51948160e-02,
         -5.32201247e-02,  -3.56107816e-02,   4.26344330e-02,
          3.93772522e-02],
       [ -2.10310504e-02,   1.98366384e-04,  -2.57383153e-02,
         -4.34088354e-02,   4.29041950e-02,   3.93772522e-02,
          8.43702337e-02]]

        if pdfname=="CT10_pdfup_qcd" and ich=="el": 
            cov = [[  5.66337058e-03,  -6.28457971e-03,   3.16142146e-03,
          8.55452774e-03,  -1.82485163e-02,  -1.01148881e-02,
         -1.98141516e-02],
       [ -6.28457971e-03,   2.58548992e-01,   6.77589636e-02,
          4.02337395e-02,   4.32301142e-02,  -5.57384679e-02,
         -4.28940086e-04],
       [  3.16142146e-03,   6.77589636e-02,   5.30762606e-01,
          6.13463485e-02,   5.01141973e-02,  -6.13518735e-02,
         -3.50795170e-02],
       [  8.55452774e-03,   4.02337395e-02,   6.13463485e-02,
          1.53275796e-01,   3.82349895e-02,  -5.89417047e-02,
         -4.79115552e-02],
       [ -1.82485163e-02,   4.32301142e-02,   5.01141973e-02,
          3.82349895e-02,   8.78670700e-01,  -3.75870735e-02,
          4.83737061e-02],
       [ -1.01148881e-02,  -5.57384679e-02,  -6.13518735e-02,
         -5.89417047e-02,  -3.75870735e-02,   4.96741867e-02,
          4.69832783e-02],
       [ -1.98141516e-02,  -4.28940086e-04,  -3.50795170e-02,
         -4.79115552e-02,   4.83737061e-02,   4.69832783e-02,
          9.16294720e-02]]

        if pdfname=="CT10_pdfdown_qcd" and ich=="el": 
            cov = [[ 0.00929047, -0.00928307, -0.0016466 ,  0.00937497, -0.02140631,
        -0.00975695, -0.02275962],
       [-0.00928307,  0.25388022,  0.07097258,  0.03947211,  0.03797439,
        -0.05416197,  0.00109166],
       [-0.0016466 ,  0.07097258,  0.53596068,  0.05258128,  0.05083459,
        -0.05178932, -0.01965172],
       [ 0.00937497,  0.03947211,  0.05258128,  0.13302916,  0.03027593,
        -0.04956203, -0.04020938],
       [-0.02140631,  0.03797439,  0.05083459,  0.03027593,  0.82744582,
        -0.0345919 ,  0.03928259],
       [-0.00975695, -0.05416197, -0.05178932, -0.04956203, -0.0345919 ,
         0.03893695,  0.03493075],
       [-0.02275962,  0.00109166, -0.01965172, -0.04020938,  0.03928259,
         0.03493075,  0.08000869]]

        # ---------------------------------- combined fit ----------------------------------
        if pdfname=="CT10_nom_qcd" and ich=="comb": 
            cov = [[  4.21709327e-03,  -8.12854362e-03,   9.57135774e-04,
         -1.96369990e-04,  -5.25913727e-03,  -2.73696838e-02,
         -3.59297387e-03,  -1.11414324e-02],
       [ -8.12854362e-03,   2.98112802e-01,  -1.09044849e-01,
          5.47082568e-03,   3.81512976e-02,   1.27666594e-02,
         -4.45068925e-02,   5.12888410e-03],
       [  9.57135774e-04,  -1.09044849e-01,   3.48606925e-01,
          1.96915346e-04,   2.69703617e-02,  -2.71890541e-02,
          3.69328597e-03,   1.11211241e-03],
       [ -1.96369990e-04,   5.47082568e-03,   1.96915346e-04,
          2.93803780e-02,   3.96195152e-02,  -5.59125982e-03,
         -8.11909736e-03,  -1.58546388e-03],
       [ -5.25913727e-03,   3.81512976e-02,   2.69703617e-02,
          3.96195152e-02,   1.98118308e-01,  -9.16749028e-03,
         -2.11783615e-02,   9.26102463e-03],
       [ -2.73696838e-02,   1.27666594e-02,  -2.71890541e-02,
         -5.59125982e-03,  -9.16749028e-03,   8.32760581e-01,
         -6.80099307e-03,   6.93732035e-02],
       [ -3.59297387e-03,  -4.45068925e-02,   3.69328597e-03,
         -8.11909736e-03,  -2.11783615e-02,  -6.80099307e-03,
          1.96880949e-02,   1.41961739e-02],
       [ -1.11414324e-02,   5.12888410e-03,   1.11211241e-03,
         -1.58546388e-03,   9.26102463e-03,   6.93732035e-02,
          1.41961739e-02,   3.92265305e-02]]
            
        if pdfname=="CT10_pdfup_qcd" and ich=="comb": 
            cov = [[  3.52197508e-03,  -6.61365645e-03,   6.36907160e-04,
         -8.73836118e-05,  -4.47250171e-03,  -2.78558481e-02,
         -4.42362636e-03,  -1.07583616e-02],
       [ -6.61365645e-03,   2.90039888e-01,  -1.18827517e-01,
          4.85283910e-03,   3.67964985e-02,   1.61983465e-02,
         -4.39065188e-02,   3.91394209e-03],
       [  6.36907160e-04,  -1.18827517e-01,   3.79157651e-01,
         -2.53660635e-05,   2.80524192e-02,  -3.21623704e-02,
          5.48827046e-03,   1.93432585e-03],
       [ -8.73836118e-05,   4.85283910e-03,  -2.53660635e-05,
          2.98842313e-02,   3.99374919e-02,  -6.06959000e-03,
         -8.52533992e-03,  -1.85598364e-03],
       [ -4.47250171e-03,   3.67964985e-02,   2.80524192e-02,
          3.99374919e-02,   1.99494554e-01,  -1.01067064e-02,
         -2.10729355e-02,   8.71535693e-03],
       [ -2.78558481e-02,   1.61983465e-02,  -3.21623704e-02,
         -6.06959000e-03,  -1.01067064e-02,   8.70937475e-01,
         -9.96838602e-04,   8.20498558e-02],
       [ -4.42362636e-03,  -4.39065188e-02,   5.48827046e-03,
         -8.52533992e-03,  -2.10729355e-02,  -9.96838602e-04,
          2.38641174e-02,   1.84442834e-02],
       [ -1.07583616e-02,   3.91394209e-03,   1.93432585e-03,
         -1.85598364e-03,   8.71535693e-03,   8.20498558e-02,
          1.84442834e-02,   4.18692654e-02]]
            
        if pdfname=="CT10_pdfdown_qcd" and ich=="comb": 
            cov = [[  5.12011559e-03,  -9.43792036e-03,   1.11646802e-03,
         -2.60890585e-04,  -6.17684781e-03,  -2.76233469e-02,
         -3.20390133e-03,  -1.18287073e-02],
       [ -9.43792036e-03,   2.88738196e-01,  -9.89941507e-02,
          5.46100579e-03,   3.77450184e-02,   1.14620103e-02,
         -4.25040488e-02,   6.45661704e-03],
       [  1.11646802e-03,  -9.89941507e-02,   3.25453842e-01,
          3.23624827e-04,   2.61480419e-02,  -2.42573291e-02,
          2.42152428e-03,   7.76260567e-04],
       [ -2.60890585e-04,   5.46100579e-03,   3.23624827e-04,
          2.86145038e-02,   3.90597380e-02,  -5.18969889e-03,
         -7.73096468e-03,  -1.43205234e-03],
       [ -6.17684781e-03,   3.77450184e-02,   2.61480419e-02,
          3.90597380e-02,   2.00360015e-01,  -7.75726951e-03,
         -2.08430950e-02,   1.00181187e-02],
       [ -2.76233469e-02,   1.14620103e-02,  -2.42573291e-02,
         -5.18969889e-03,  -7.75726951e-03,   7.99828057e-01,
         -9.67281314e-03,   6.06558502e-02],
       [ -3.20390133e-03,  -4.25040488e-02,   2.42152428e-03,
         -7.73096468e-03,  -2.08430950e-02,  -9.67281314e-03,
          1.71600921e-02,   1.17687767e-02],
       [ -1.18287073e-02,   6.45661704e-03,   7.76260567e-04,
         -1.43205234e-03,   1.00181187e-02,   6.06558502e-02,
          1.17687767e-02,   3.77330555e-02]]
            

        if ich=="comb":
            labels = ['#beta_{signal}', 'JEC', 'JER', 'N(el QCD)', 'N(mu QCD)', 'N(single top)', 'N(W+jet)', 'Top-tagging']
        elif ich=="mu" :
            labels = ['#beta_{signal}', 'JEC', 'JER', 'N(mu QCD)', 'N(single top)', 'N(W+jet)', 'Top-tagging']
        else:
            labels = ['#beta_{signal}', 'JEC', 'JER', 'N(el QCD)', 'N(single top)', 'N(W+jet)', 'Top-tagging']


        nvars = len(cov[0])
        corhist = TH2F('corhist', '', nvars, 0, nvars, nvars, 0, nvars )

        for x in xrange(nvars) :
            corhist.GetXaxis().SetLabelSize(0.05)
            corhist.GetXaxis().SetLabelOffset(0.01)
            corhist.GetYaxis().SetLabelSize(0.05)
            corhist.GetXaxis().SetBinLabel( x+1, labels[x] )
            corhist.GetYaxis().SetBinLabel( x+1, labels[x] )
    
        for irow in xrange(nvars) :
            for icol in xrange( nvars) :
                correlation = cov[irow][icol] / ( sqrt(cov[irow][irow]) * sqrt(cov[icol][icol]) )
                corhist.SetBinContent( irow+1, icol+1, correlation)

        c = TCanvas('c', 'c', 700, 600)
        c.SetLeftMargin(0.18)
        c.SetRightMargin(0.13)
        c.SetTopMargin(0.05)
        c.SetBottomMargin(0.13)

        corhist.SetMaximum(1.0)
        corhist.SetMinimum(-1.0)
        corhist.Draw('colz text')
    

        c.Print("correlations_"+pdfname+"_"+ich+"_extlumibtag.pdf")
        c.Print("correlations_"+pdfname+"_"+ich+"_extlumibtag.png")


